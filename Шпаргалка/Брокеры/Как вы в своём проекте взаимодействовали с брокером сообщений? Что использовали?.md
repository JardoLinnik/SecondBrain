> –í –º–æ—ë–º –ø—Ä–æ–µ–∫—Ç–µ –≤ –¢-–ë–∞–Ω–∫–µ –º—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ **Kafka** –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω—É—é —Å–æ–±—ã—Ç–∏–π–Ω—É—é —à–∏–Ω—É –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ **RabbitMQ** –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á, —Ä–µ—Ç—Ä–∞–µ–≤ –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
> 
> –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è –±—ã–ª–∞ –≤ —Ç–æ–º, —á—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–≤—è–∑–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã:  
> –±–∏–∑–Ω–µ—Å-—Å–æ–±—ã—Ç–∏—è, —Ç–∞–∫–∏–µ –∫–∞–∫ `transaction.created`, `client.updated`, `limit.changed`, –ø—É–±–ª–∏–∫–æ–≤–∞–ª–∏—Å—å –≤ Kafka,  
> –∞ RabbitMQ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ —Ñ–æ–Ω–æ–≤—ã—Ö job‚Äô–æ–≤ ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—á—ë—Ç–æ–≤, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ —Ä–µ—Ç—Ä–∞–µ–≤ –Ω–µ—É–¥–∞—á–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π.
> 
> –Ø –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª Kafka-—Ç–æ–ø–∏–∫–∏, —Å—Ö–µ–º—É –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, `acks=all` –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã—Ö –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤, —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞–ª **exactly-once** —Ç–∞–º, –≥–¥–µ —Ä–∞–±–æ—Ç–∞–ª–∏ —Å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏.  
> –î–ª—è RabbitMQ ‚Äî –ø–æ–¥–Ω–∏–º–∞–ª –æ—á–µ—Ä–µ–¥—å —Å `TTL`, `DLQ` –∏ `retry`, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –∑–∞–¥–∞—á–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

---

## üîπ Kafka ‚Äî —Å–æ–±—ã—Ç–∏–π–Ω–∞—è —à–∏–Ω–∞ –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–±—ã—Ç–∏–π –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ **–∞–Ω—Ç–∏—Ñ—Ä–æ–¥–∞, —Å–∫–æ—Ä–∏–Ω–≥–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏**.
    
- –°—Ö–µ–º—ã —Å–æ–æ–±—â–µ–Ω–∏–π –æ–ø–∏—Å—ã–≤–∞–ª–∏—Å—å –≤ **Avro**, —á–µ—Ä–µ–∑ **Schema Registry**, —á—Ç–æ–±—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –Ω–∞ –æ–¥–Ω–æ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ.
    
- –î–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏:
    
    - `acks=all`,
        
    - `enable.idempotence=true`,
        
    - `replication.factor=3`,
        
    - `min.insync.replicas=2`.
        
- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –ø–æ `client_id`, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–æ–±—ã—Ç–∏–π –≤ —Ä–∞–º–∫–∞—Ö –∫–ª–∏–µ–Ω—Ç–∞.
    
- –ö–æ–Ω—Å—å—é–º–µ—Ä—ã –±—ã–ª–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–æ–º–µ–Ω–∞–º (`fraud-consumer`, `ml-consumer`, `analytics-consumer`).
    

üìò **–ü—Ä–∏–º–µ—Ä –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞**

> –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å `transaction-service` –ø—É–±–ª–∏–∫–æ–≤–∞–ª —Å–æ–±—ã—Ç–∏–µ `transaction.created` –≤ Kafka.  
> –ï–≥–æ —Å–ª—É—à–∞–ª–∏:
> 
> - `fraud-service` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∞–Ω—Ç–∏—Ñ—Ä–æ–¥–∞;
>     
> - `ml-service` ‚Äî –æ–±–Ω–æ–≤–ª—è–ª —Ñ–∏—á–∏ –¥–ª—è –º–æ–¥–µ–ª–∏;
>     
> - `analytics-service` ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–ª —Å–æ–±—ã—Ç–∏–µ –≤ ClickHouse.
>     
> 
> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, Kafka –ø–æ–∑–≤–æ–ª–∏–ª–∞ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Å–æ–±—ã—Ç–∏–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**, –≥–¥–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞.

---

## üîπ RabbitMQ ‚Äî —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏, —Ä–µ—Ç—Ä–∞–∏ –∏ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ—á–µ—Ä–µ–¥–µ–π –∑–∞–¥–∞—á**: –æ—Ç—á—ë—Ç—ã, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, —Ä–µ–µ—Å—Ç—Ä—ã.
    
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
    
    - `x-dead-letter-exchange` ‚Äî –¥–ª—è DLQ,
        
    - `x-message-ttl` ‚Äî –¥–ª—è –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π,
        
    - `prefetch_count` ‚Äî –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∫–æ–Ω—Å—å—é–º–µ—Ä–æ–≤.
        
- –†–µ–∞–ª–∏–∑–æ–≤–∞–ª **retry-–º–µ—Ö–∞–Ω–∏–∫—É** —Å backoff-–∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ (30 —Å–µ–∫ / 1 –º–∏–Ω / 5 –º–∏–Ω).
    
- –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–¥–∞—á–∞—Ö ‚Äî `fanout exchange`, —á—Ç–æ–±—ã –æ–¥–Ω–æ —Å–æ–±—ã—Ç–∏–µ —à–ª–æ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –æ—á–µ—Ä–µ–¥—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è).
    

üìò **–ü—Ä–∏–º–µ—Ä**

> –ü–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è —Å –∫–∞—Ä—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ø–∞–¥–∞–ª–æ –≤ retry-–æ—á–µ—Ä–µ–¥—å RabbitMQ —Å TTL 60 —Å–µ–∫—É–Ω–¥.  
> –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–ª–∞—Å—å 3 —Ä–∞–∑–∞ ‚Äî –∑–∞–¥–∞—á–∞ —É—Ö–æ–¥–∏–ª–∞ –≤ DLQ, –∏ —Å–µ—Ä–≤–∏—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–Ω–∏–º–∞–ª –∞–ª–µ—Ä—Ç –≤ Grafana.

---

## üîπ –ü–∞—Ç—Ç–µ—Ä–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ–Ω—è–ª

- **Outbox + Relay** ‚Äî —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã ‚Äú–¥–≤–æ–π–Ω–æ–π –∑–∞–ø–∏—Å–∏‚Äù (–≤ –ë–î –∏ Kafka –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ).
    
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Å—å—é–º–µ—Ä—ã** ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è `event_id` –≤ Redis/–ë–î.
    
- **Backoff + Jitter** ‚Äî —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ª–∞–≤–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö —Ä–µ—Ç—Ä–∞–µ–≤.
    
- **Tracing** ‚Äî –¥–æ–±–∞–≤–ª—è–ª `trace_id` –≤ Kafka headers, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ü–µ–ø–æ—á–∫—É —Å–æ–±—ã—Ç–∏–π –≤ Jaeger.
    

---

## üîπ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è

- Kafka: `consumer lag`, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ç–æ–ø–∏–∫–∞—Ö, offset commit delay.
    
- RabbitMQ: –≥–ª—É–±–∏–Ω–∞ –æ—á–µ—Ä–µ–¥–µ–π, DLQ-rate, unacked count.
    
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª **Prometheus + Grafana** –¥–ª—è –º–µ—Ç—Ä–∏–∫ –∏ **OpenTelemetry** –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞.
    
- –í Grafana —Å—Ç–æ—è–ª–∏ –∞–ª–µ—Ä—Ç—ã, –µ—Å–ª–∏ lag > N —Å–µ–∫—É–Ω–¥ –∏–ª–∏ DLQ –Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Ç–∏.
    

---

## üí¨ –ö–∞–∫ –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ—Ç–≤–µ—Ç

> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, Kafka –æ–±–µ—Å–ø–µ—á–∏–≤–∞–ª–∞ –Ω–∞–º **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é —Å–æ–±—ã—Ç–∏–π–Ω—É—é –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é** –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏,  
> –∞ RabbitMQ —Ä–µ—à–∞–ª –∑–∞–¥–∞—á–∏ **–Ω–∞–¥—ë–∂–Ω–æ–π —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏**.
> 
> –≠—Ç–æ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –¥–∞–≤–∞–ª–æ —É—Å—Ç–æ–π—á–∏–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É: Kafka ‚Äî –¥–ª—è real-time —Å—Ç—Ä–∏–º–æ–≤ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, RabbitMQ ‚Äî –¥–ª—è —É–ø—Ä–∞–≤–ª—è–µ–º—ã—Ö workflow –∏ —Ä–µ—Ç—Ä–∞–µ–≤.