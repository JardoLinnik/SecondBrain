
# Движек мультиканальной синхронизации товарных остатков.



# Антифрод Сервис

Антифрод построен как streaming pipeline.  
Все доменные сервисы отправляют raw-события в adapters, которые нормализуют данные и кладут их в Kafka `fraud.events.raw`. Далее Feature Builder в стриме считает фичи и пишет их в `fraud.features`. Антифрод сервис подписывается на этот фичевой поток, вызывает ML inference сервис, применяет rule-based слой и принимает решение. Решения пишутся в Decision Store и в Kafka для аналитики. Latency — около 10–25 ms end-to-end

1. Данные постуают из сервиса заказов, системы лояльности, системы платежей в основном.
	- Тянут данные по типу отмены заказов, возврат, изменения оплаты ... любые странные последовательности действий из других сервисов.
	- Направляют эти "сырые данные" по топику кафки в сервис обработки данных
	- Внутри этот сервис ходит в базы данных, передает какие-то данные для дальнейшей обработки в Clickhouse, компилирует в маленькие батчи
	- После этого данные передаются в топик готовых данных и поступают в Antifrud (получает готовые векторы)
	- Сам антифрод сервис только плучает векторы, вызывает внутри себя модель и принимает решение.
	- Модель получает только фичи
	- Решения идут в топик кафки для аналитики, мониторинга и хранения.
	   







# Сервис предугадывания товарных остатков


Доп.Вопросы:

## Антифрод

Как достигли near real time инференса модели?

1.Модель живет отдельно от сервиса антифрода
	Независимый деплой модели
	Возможность держать модель в RAM
	Нет холодных стартов заранее все подгружает
2.Модель в RAM
	Модель десериализуется
	Потокобезопасен процесс модели
	**Сократили время запроса до модели до 1-5 ms**
3. Переход на gRPC , HTTP keep alive
	- Убрали HTTP нагрузку
4. Работаем одним вектором а не батчем, чтобы не дожидаться накопления, а реагировать сразу.
5. Feature builder считает фичи в стриме и уменьшает нагрузку на антифрод.
6. Feature builder заранее делает тяжёлую работу:

- агрегации,
- lookups,
- частоты,
- истории поведения,
- статистики по пользователю / заказу,
- geospatial / паттерны.

7. Faststream архитектура
8. Горизонтальное масштабироване только inference слоя 