> **`select_related`** –∏ **`prefetch_related`** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã Django ORM,  
> –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç **–∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã ‚ÄúN+1 –∑–∞–ø—Ä–æ—Å–æ–≤‚Äù** –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏.
> 
> –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –Ω–∏–º–∏ –≤ —Ç–æ–º, **–∫–∞–∫–æ–π —Ç–∏–ø —Å–≤—è–∑–∏** –æ–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç:
> 
> - `select_related` ‚Äî –¥–ª—è —Å–≤—è–∑–µ–π **ForeignKey / OneToOne** (–æ–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É, –º–Ω–æ–≥–∏–µ –∫ –æ–¥–Ω–æ–º—É)
>     
> - `prefetch_related` ‚Äî –¥–ª—è —Å–≤—è–∑–µ–π **ManyToMany / reverse ForeignKey** (–æ–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º, –º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º)
>     

---

## üß© –ü—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

### üéØ –ë–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Ç–∏–ø–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞)

`orders = Order.objects.all() for order in orders:     print(order.customer.name)`

‚Äî Django —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ—Ç 1 –∑–∞–ø—Ä–æ—Å –Ω–∞ `Order`,  
–∞ –ø–æ—Ç–æ–º –¥–ª—è **–∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞** –¥–µ–ª–∞–µ—Ç –µ—â—ë 1 –∑–∞–ø—Ä–æ—Å –Ω–∞ `Customer`.  
–ï—Å–ª–∏ –∑–∞–∫–∞–∑–æ–≤ 100 ‚Äî –ø–æ–ª—É—á–∏—Ç—Å—è 101 SQL-–∑–∞–ø—Ä–æ—Å üò¨

---

### ‚ö° –° `select_related`

`orders = Order.objects.select_related('customer') for order in orders:     print(order.customer.name)`

‚Äî Django –¥–µ–ª–∞–µ—Ç **–æ–¥–∏–Ω SQL-–∑–∞–ø—Ä–æ—Å —Å JOIN**,  
–∏ —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–∫–∞–∑–æ–≤, –∏ –∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.  
üëâ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Å–≤—è–∑–µ–π `ForeignKey`, `OneToOne`.

---

### ‚öôÔ∏è –° `prefetch_related`

`customers = Customer.objects.prefetch_related('orders') for customer in customers:     print([o.id for o in customer.orders.all()])`

‚Äî Django –¥–µ–ª–∞–µ—Ç **–¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞**:  
1Ô∏è‚É£ –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤  
2Ô∏è‚É£ –ü–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∑–∞–∫–∞–∑—ã, –≥–¥–µ `customer_id` –≤ —Å–ø–∏—Å–∫–µ –∫–ª–∏–µ–Ω—Ç–æ–≤  
–∏ **—Å–∞–º —Å–≤—è–∑—ã–≤–∞–µ—Ç –∏—Ö –≤ –ø–∞–º—è—Ç–∏**.  
üëâ –ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è `ManyToMany` –∏–ª–∏ –æ–±—Ä–∞—Ç–Ω—ã—Ö —Å–≤—è–∑–µ–π (`related_name`).

---

## üß† –ö–∞–∫ –∑–∞–ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç–æ:

|–ú–µ—Ç–æ–¥|–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å|–ß—Ç–æ –¥–µ–ª–∞–µ—Ç|–ö–æ–ª-–≤–æ SQL|
|---|---|---|---|
|`select_related`|`ForeignKey`, `OneToOne`|JOIN –≤ SQL|1|
|`prefetch_related`|`ManyToMany`, –æ–±—Ä–∞—Ç–Ω—ã–µ `ForeignKey`|2 –∑–∞–ø—Ä–æ—Å–∞ + —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤ Python|2|

---

## üí¨ –ö–∞–∫ —Å–∫–∞–∑–∞—Ç—å —ç—Ç–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏:

> –í Django `select_related` –∏ `prefetch_related` –Ω—É–∂–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.
> 
> `select_related` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ —É –Ω–∞—Å —Å–≤—è–∑—å –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É –∏–ª–∏ –º–Ω–æ–≥–∏–µ-–∫-–æ–¥–Ω–æ–º—É ‚Äî –æ–Ω –¥–µ–ª–∞–µ—Ç JOIN –∏ –ø–æ–ª—É—á–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º.
> 
> `prefetch_related` ‚Äî –∫–æ–≥–¥–∞ —É –Ω–∞—Å –æ–±—Ä–∞—Ç–Ω—ã–µ –∏–ª–∏ –º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º —Å–≤—è–∑–∏. –û–Ω –¥–µ–ª–∞–µ—Ç –¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏.
> 
> –û–±–∞ –º–µ—Ç–æ–¥–∞ –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–±–µ–∂–∞—Ç—å N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä—è—é—Ç —Ä–∞–±–æ—Ç—É ORM.