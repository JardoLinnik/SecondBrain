pg_stat — это набор системных представлений и таблиц статистики в PostgreSQL, которые предоставляют информацию о состоянии базы данных, активности запросов, использовании памяти, блокировках, индексах и многом другом.Основные представления pg_stat  
Вот наиболее важные представления pg_stat, их описание и примеры использования:  
1. pg_stat_activity  
Описание: Содержит информацию о текущих активных соединениях, выполняемых запросах и состоянии процессов.  
Пример запроса:  
SELECT pid, usename, state, query, query_start  
FROM pg_stat_activity;  
Ключевые поля:  
pid — идентификатор процесса.  
usename — имя пользователя.  
state — состояние соединения (active, idle, idle in transaction).  
query — выполняемый SQL-запрос.  
  
2. pg_stat_database  
Описание: Содержит агрегированную статистику по базам данных.  
Пример запроса:  
  
SELECT datname, numbackends, xact_commit, xact_rollback, blks_read, blks_hit  
FROM pg_stat_database;  
Ключевые поля:  
datname — имя базы данных.  
numbackends — количество активных подключений.  
xact_commit — количество зафиксированных транзакций.  
blks_read — количество чтений с диска.  
blks_hit — количество обращений к кэшу (в памяти).  
  
3. pg_stat_user_tables  
Описание: Предоставляет статистику по пользовательским таблицам.  
Пример запроса:  
  
SELECT relname, seq_scan, seq_tup_read, idx_scan, idx_tup_fetch  
FROM pg_stat_user_tables;  
Ключевые поля:  
relname — имя таблицы.  
seq_scan — количество последовательных сканирований.  
idx_scan — количество сканирований индекса.  
n_tup_ins, n_tup_upd, n_tup_del — количество вставок, обновлений и удалений.  
  
4. pg_stat_user_indexes  
Описание: Информация об использовании индексов.  
Пример запроса:  
SELECT relname, indexrelname, idx_scan, idx_tup_read, idx_tup_fetch  
FROM pg_stat_user_indexes;  
Ключевые поля:  
relname — имя таблицы.  
indexrelname — имя индекса.  
idx_scan — количество раз, когда индекс был использован.  
  
5. pg_stat_bgwriter  
Описание: Статистика фоновой записи данных на диск.  
Пример запроса:  
SELECT checkpoints_timed, buffers_checkpoint, buffers_clean  
FROM pg_stat_bgwriter;  
Ключевые поля:  
checkpoints_timed — количество выполненных контрольных точек.  
buffers_checkpoint — количество буферов, записанных во время контрольных точек.  
buffers_clean — количество буферов, записанных фоновым процессом.  
  
6. pg_stat_replication  
Описание: Отслеживает состояние репликации между мастером и репликами.  
Пример запроса:  
  
SELECT pid, usename, application_name, client_addr, state  
FROM pg_stat_replication;  
Ключевые поля:  
application_name — имя репликационного приложения.  
state — состояние репликации (streaming, catchup, startup).