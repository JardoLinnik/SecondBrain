> **Kaniko** ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–æ–≤ **–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏–ª–∏ Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞**, –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å Docker Daemon.
> 
> –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –≤ CI/CD-–ø–∞–π–ø–ª–∞–π–Ω–µ –≤ –¢-–ë–∞–Ω–∫–µ –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ –ø—Ä—è–º–æ –≤ Kubernetes-runner'–∞—Ö, –≥–¥–µ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ `docker:dind`.
> 
> Kaniko —á–∏—Ç–∞–µ—Ç `Dockerfile`, —Å—Ç—Ä–æ–∏—Ç –æ–±—Ä–∞–∑ —Å–ª–æ–π –∑–∞ —Å–ª–æ–µ–º –∏ –ø—É—à–∏—Ç –µ–≥–æ –≤ Registry (GitLab Registry, Harbor, –∏–ª–∏ cr.yandex), –ø–æ–ª–Ω–æ—Å—Ç—å—é **–±–µ–∑ root-–¥–æ—Å—Ç—É–ø–∞**.
> 
> –≠—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ.

---

## üîπ –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–û–±—ã—á–Ω–æ –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker build`, –Ω–æ:

- `docker` —Ç—Ä–µ–±—É–µ—Ç root-–¥–æ—Å—Ç—É–ø–∞;
    
- –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Docker Daemon**, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ CI;
    
- –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Å–±–æ—Ä–∫–∏ **–≤–Ω—É—Ç—Ä–∏ Kubernetes** (security policies, sandbox).
    

üëâ **Kaniko** —Ä–µ—à–∞–µ—Ç —ç—Ç–∏ –ø—Ä–æ–±–ª–µ–º—ã ‚Äî –æ–Ω **—ç–º—É–ª–∏—Ä—É–µ—Ç —Å–±–æ—Ä–∫—É –æ–±—Ä–∞–∑–∞ –≤ userspace**, –±–µ–∑ –¥–µ–º–æ–Ω–∞ Docker.

---

## üîπ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç Kaniko

1. –ß–∏—Ç–∞–µ—Ç `Dockerfile` –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∫–∞–∫ –æ–±—ã—á–Ω—ã–π docker build).
    
2. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —Å–ª–æ–π (`RUN`, `COPY`, `ADD`).
    
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É.
    
4. –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –∏ –ø—É—à–∏—Ç –µ–≥–æ –≤ registry (—á–µ—Ä–µ–∑ HTTPS API).
    

üìò –ü—Ä–∏ —ç—Ç–æ–º:

- –ù–µ —Ç—Ä–µ–±—É–µ—Ç `--privileged` —Ä–µ–∂–∏–º–∞.
    
- –†–∞–±–æ—Ç–∞–µ—Ç –≤ **Kubernetes Pod**, **GitLab CI runner‚Äô–µ** –∏–ª–∏ **Cloud Build**.
    
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
    

---

## üîπ –ü—Ä–∏–º–µ—Ä –∏–∑ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ (GitLab CI)

```
build:
  stage: build
  image:
    name: gcr.io/kaniko-project/executor:latest
    entrypoint: [""]
  script:
    - echo "{\"auths\":{\"$CI_REGISTRY\":{\"username\":\"$CI_REGISTRY_USER\",\"password\":\"$CI_REGISTRY_PASSWORD\"}}}" > /kaniko/.docker/config.json
    - /kaniko/executor
        --context $CI_PROJECT_DIR
        --dockerfile $CI_PROJECT_DIR/Dockerfile
        --destination $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA
        --cache=true

```

üìç Kaniko –±–µ—Ä—ë—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –∏–∑ CI, —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑ –∏ –ø—É—à–∏—Ç –≤ `registry.tbank.local/backend/app:$CI_COMMIT_SHA`.

---

## üîπ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Kaniko

|–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ|–ß—Ç–æ –¥–∞—ë—Ç|
|---|---|
|üß± **–ë–µ–∑ Docker Daemon**|–ú–æ–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –≤ —Å—Ä–µ–¥–∞—Ö –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ root|
|üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**|–†–∞–±–æ—Ç–∞–µ—Ç –≤ user-space, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç `--privileged`|
|‚òÅÔ∏è **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Kubernetes**|–ò–¥–µ–∞–ª–µ–Ω –¥–ª—è cloud-native CI/CD (GitLab, ArgoCD, Tekton)|
|‚öôÔ∏è **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤**|–£—Å–∫–æ—Ä—è–µ—Ç —Å–±–æ—Ä–∫—É|
|üì¶ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ Dockerfile-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**|–°–æ–≤–º–µ—Å—Ç–∏–º —Å –æ–±—ã—á–Ω—ã–º `docker build`|
|üîÅ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD**|GitLab, Jenkins, GitHub Actions, Cloud Build|

---

## üîπ –ü—Ä–∏–º–µ—Ä –∏–∑ —Ç–≤–æ–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–¢-–ë–∞–Ω–∫)

> –£ –Ω–∞—Å Kaniko –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–∞–π–ø–ª–∞–π–Ω–∞—Ö GitLab CI –¥–ª—è —Å–±–æ—Ä–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä—è–º–æ –≤ Kubernetes-runner‚Äô–∞—Ö.
> 
> –≠—Ç–æ —É–¥–æ–±–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ:
> 
> - –Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç docker:dind;
>     
> - –ø–∞–π–ø–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–Ω—É—Ç—Ä–∏ k8s (secure namespace);
>     
> - –æ–±—Ä–∞–∑—ã –ø—É—à–∞—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –≤ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π **GitLab Registry**;
>     
> - –∫–∞–∂–¥–∞—è —Å–±–æ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è.
>     
> 
> –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–±–æ—Ä–∫–∞ —Å—Ç–∞–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π, –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∏ –±—ã—Å—Ç—Ä–æ–π.

---

## üí¨ –ö–∞–∫ –º–æ–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ—Ç–≤–µ—Ç

> –í —Ü–µ–ª–æ–º, Kaniko ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è **cloud-native —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤**:  
> –æ–Ω –±–µ–∑–æ–ø–∞—Å–µ–Ω, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç root-–¥–æ—Å—Ç—É–ø–∞, –∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è CI/CD –≤ Kubernetes.
> 
> –í –¢-–ë–∞–Ω–∫–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –¥–ª—è —Å–±–æ—Ä–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –ø—Ä—è–º–æ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ, —á—Ç–æ–±—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–∫–ª—é—á–∏—Ç—å Docker Daemon –∏–∑ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –∏ –ø–æ–≤—ã—Å–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å