> –ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é `RUN rm ...` –≤ Dockerfile,  
> —Ç–æ **–æ–Ω –∏—Å—á–µ–∑–Ω–µ—Ç –∏–∑ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**,  
> –Ω–æ **—Ñ–∏–∑–∏—á–µ—Å–∫–∏ –º–µ—Å—Ç–æ –≤ –æ–±—Ä–∞–∑–µ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è**,  
> –ø–æ—Ç–æ–º—É —á—Ç–æ Docker **–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–æ–π–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É (union filesystem)**.

---

## üß± –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ

–ö–∞–∂–¥–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `RUN`, `COPY`, `ADD` –≤ Dockerfile —Å–æ–∑–¥–∞—ë—Ç **–Ω–æ–≤—ã–π —Å–ª–æ–π** (layer).  
Docker —Ö—Ä–∞–Ω–∏—Ç —ç—Ç–∏ —Å–ª–æ–∏ –∫–∞–∫ ‚Äú—Å–Ω–∏–º–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π‚Äù —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã.

–ü—Ä–∏–º–µ—Ä:

`FROM python:3.10  COPY app /app          # ‚Üê —Å–ª–æ–π 1 (–¥–æ–±–∞–≤–∏–ª–∏ —Ñ–∞–π–ª—ã) RUN rm -rf /app/tests  # ‚Üê —Å–ª–æ–π 2 (—É–¥–∞–ª–∏–ª–∏ —Ñ–∞–π–ª—ã)`

üß† –í–∞–∂–Ω–æ:

- –§–∞–π–ª—ã –∏–∑ `/app/tests` **–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±—É–¥—É—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å** –≤ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ,
    
- –ù–æ **–∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –Ω–∏–∂–Ω–µ–º —Å–ª–æ–µ** ‚Äî Docker –Ω–µ —É–º–µ–µ—Ç ‚Äú–ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å‚Äù —Å—Ç–∞—Ä—ã–µ —Å–ª–æ–∏.
    
- –í –∏—Ç–æ–≥–µ –∏—Ç–æ–≥–æ–≤—ã–π –æ–±—Ä–∞–∑ –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å **—Ç–æ –∂–µ –º–µ—Å—Ç–æ**, –∫–∞–∫ –µ—Å–ª–∏ –±—ã —Ç—ã —Ñ–∞–π–ª –Ω–µ —É–¥–∞–ª—è–ª.
    

---

## üí° –ü–æ—á–µ–º—É —Ç–∞–∫

Docker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç _copy-on-write_ —Å–∏—Å—Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, **OverlayFS**):

- –ö–∞–∂–¥—ã–π —Å–ª–æ–π —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑–Ω–∏—Ü—É –ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º.
    
- –ö–æ–≥–¥–∞ —Ç—ã ‚Äú—É–¥–∞–ª—è–µ—à—å‚Äù —Ñ–∞–π–ª, –≤ –Ω–æ–≤–æ–º —Å–ª–æ–µ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—á–∞–µ—Ç—Å—è:  
    üëâ ‚Äú—ç—Ç–æ—Ç —Ñ–∞–π–ª –±–æ–ª—å—à–µ –Ω–µ –≤–∏–¥–µ–Ω‚Äù,  
    –Ω–æ **–¥–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è** –≤ —Å—Ç–∞—Ä–æ–º —Å–ª–æ–µ.
    

---

## ‚öôÔ∏è –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª –∏ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞

–ù—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å **–≤—Å—ë –≤ –æ–¥–Ω–æ–º RUN**, —á—Ç–æ–±—ã –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ —Å–ª–æ–∏.

‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:

`COPY app /app RUN rm -rf /app/tests`

‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ:

`COPY app /app RUN rm -rf /app/tests && pip install -r /app/requirements.txt`

–∏–ª–∏ –µ—â—ë –ª—É—á—à–µ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–º—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂ –±–∏–ª–¥**:

`FROM python:3.10 AS builder COPY app /app RUN pytest /app/tests  FROM python:3.10-slim COPY --from=builder /app /app`

üí° –¢–æ–≥–¥–∞ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∞–ø–µ —Å–±–æ—Ä–∫–∏, –≤–æ–æ–±—â–µ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑.

---

## üí¨ –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å —ç—Ç–æ –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> –ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª —á–µ—Ä–µ–∑ `RUN rm` –≤ Dockerfile, –æ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–ø–∞–¥—ë—Ç –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞,  
> –Ω–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –≤ –Ω–∏–∂–Ω–∏—Ö —Å–ª–æ—è—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ Docker —Ö—Ä–∞–Ω–∏—Ç –∫–∞–∂–¥—ã–π —à–∞–≥ —Å–±–æ—Ä–∫–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π.
> 
> –ü–æ—ç—Ç–æ–º—É –º–µ—Å—Ç–æ –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è.
> 
> –ß—Ç–æ–±—ã —Ä–µ–∞–ª—å–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞, —É–¥–∞–ª–µ–Ω–∏–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å **–≤ —Ç–æ–º –∂–µ RUN**, –≥–¥–µ —Ñ–∞–π–ª –±—ã–ª —Å–æ–∑–¥–∞–Ω,  
> –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–º—É–ª—å—Ç–∏—Å—Ç–µ–π–¥–∂ –±–∏–ª–¥—ã**.


–§–∞–π–ª —É–¥–∞–ª–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–æ –æ–±—ä—ë–º –æ–±—Ä–∞–∑–∞ –Ω–µ —É–º–µ–Ω—å—à–∏—Ç—Å—è (–µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–µ –≤ —Ç–æ–º –∂–µ —Å–ª–æ–µ, –≥–¥–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π) –∏ –Ω–∞ —Ö–æ—Å—Ç–µ —Ç–æ–∂–µ –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª–∏—Ç—Å—è (–µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ –±—ã–ª –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ volume)