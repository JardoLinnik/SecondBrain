> **Grafana** â€” ÑÑ‚Ð¾ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ð° Ð´Ð»Ñ **Ð²Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¼ÐµÑ‚Ñ€Ð¸Ðº, Ð»Ð¾Ð³Ð¾Ð² Ð¸ Ñ‚Ñ€ÐµÐ¹ÑÐ¾Ð²**.
> 
> ÐžÐ½Ð° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ðº Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ°Ð¼ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Prometheus, Loki, Tempo, Elasticsearch, PostgreSQL Ð¸ Ð´Ñ€.) Ð¸ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ **Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ñ‹, Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¸ Ð¸ Ð°Ð»ÐµÑ€Ñ‚Ñ‹**.
> 
> Ð’ Ð¢-Ð‘Ð°Ð½ÐºÐµ Ð¼Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Grafana ÐºÐ°Ðº **ÐµÐ´Ð¸Ð½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð½Ð°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸**:  
> Ð½Ð° Ð¾Ð´Ð½Ð¾Ð¼ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ðµ Ð²Ð¸Ð´Ð¸Ð¼ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸, ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸, Ð»Ð¾Ð³Ð¸ (Ð¸Ð· Loki) Ð¸ Ñ‚Ñ€Ð°ÑÑÐ¸Ñ€Ð¾Ð²ÐºÐ¸ (Ð¸Ð· Tempo Ð¸Ð»Ð¸ Jaeger).
> 
> ÐÐ»ÐµÑ€Ñ‚Ñ‹ Ð¸Ð· Grafana Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ÑÑ Ð² Slack Ð¸Ð»Ð¸ PagerDuty, Ð° Ð´Ð»Ñ Ð¸Ð½Ñ†Ð¸Ð´ÐµÐ½Ñ‚Ð¾Ð² Ð¼Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹Ðµ runbook-ÑÑÑ‹Ð»ÐºÐ¸ Ð¿Ñ€ÑÐ¼Ð¾ Ñ Ð¿Ð°Ð½ÐµÐ»Ð¸.

---

## ðŸ”¹ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Grafana

- ðŸ“Š **Ð’Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ** â€” Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¸, Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹, heatmap, pie chart, single stat.
    
- ðŸ” **Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´Ñ‹** â€” Ð¾Ð±ÑŠÐµÐ´Ð¸Ð½ÑÑŽÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· Ñ€Ð°Ð·Ð½Ñ‹Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼ (Prometheus, Loki, Tempo, PostgreSQL).
    
- ðŸš¨ **ÐÐ»ÐµÑ€Ñ‚Ð¸Ð½Ð³** â€” Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð½Ð° Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, error rate > 2%).
    
- ðŸ”— **Correlated Observability** â€” Ð¼Ð¾Ð¶Ð½Ð¾ ÐºÐ»Ð¸ÐºÐ½ÑƒÑ‚ÑŒ Ð½Ð° `trace_id` Ð² Ð»Ð¾Ð³Ðµ Ð¸ Ð¿ÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ðº Ñ‚Ñ€Ð°ÑÑÐ¸Ñ€Ð¾Ð²ÐºÐµ.
    
- ðŸ‘¥ **ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ð¸ Ð¿Ð°Ð¿ÐºÐ¸** â€” Ñ€Ð°Ð·Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼ Ð¸ ÑÐµÑ€Ð²Ð¸ÑÐ°Ð¼.
    
- ðŸ§± **Ð’Ð¸Ð´Ð¶ÐµÑ‚Ñ‹ Ð¸ templating** â€” Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ Ð¿Ð¾ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸ÑŽ, ÑÐµÑ€Ð²Ð¸ÑÑƒ, Ð²ÐµÑ€ÑÐ¸Ð¸.
    
- ðŸ§© **Annotations** â€” Ð¿Ð¾Ð¼ÐµÑ‚ÐºÐ¸ Ñ€ÐµÐ»Ð¸Ð·Ð¾Ð² Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð½Ð° Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ°Ñ….
    
- ðŸ•µï¸ **Explore Mode** â€” Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð· Ð¼ÐµÑ‚Ñ€Ð¸Ðº, Ð»Ð¾Ð³Ð¾Ð² Ð¸ trace Ð±ÐµÐ· Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð°.
    

---

## ðŸ”¹ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸Ð· Ñ‚Ð²Ð¾ÐµÐ³Ð¾ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° (Ð¢-Ð‘Ð°Ð½Ðº)

> Ð£ Ð½Ð°Ñ Grafana Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð²ÑÐµÑ… Ð¼Ð¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² â€” Ð¾Ñ‚ FastAPI-ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð² Ð´Ð¾ Ð±Ñ€Ð¾ÐºÐµÑ€Ð¾Ð² Kafka Ð¸ RabbitMQ.
> 
> ÐšÐ°Ð¶Ð´Ñ‹Ð¹ ÑÐµÑ€Ð²Ð¸Ñ Ð¸Ð¼ÐµÐµÑ‚ ÑÐ²Ð¾Ð¹ **Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´** Ñ ÑÐµÐºÑ†Ð¸ÑÐ¼Ð¸:
> 
> - API Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸: error rate, latency (p95/p99), RPS;
>     
> - Kafka consumer lag;
>     
> - RabbitMQ queue depth;
>     
> - PostgreSQL query time Ð¸ deadlocks;
>     
> - ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ‹Ðµ CPU/memory/pods.
>     
> 
> Ð”Ð»Ñ Ð±Ð¸Ð·Ð½ÐµÑ-Ð¼ÐµÑ‚Ñ€Ð¸Ðº ÐµÑÑ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð¿Ð°Ð½ÐµÐ»Ð¸ â€” ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸, antifraud score, Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ Ð¿Ð°Ð¹Ð¿Ð»Ð°Ð¹Ð½Ð¾Ð².
> 
> Grafana Ð¿Ð¾Ð´Ñ‚ÑÐ³Ð¸Ð²Ð°ÐµÑ‚ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð¸Ð· **Prometheus**, Ð»Ð¾Ð³Ð¸ Ð¸Ð· **Loki**, Ñ‚Ñ€ÐµÐ¹ÑÑ‹ Ð¸Ð· **Tempo** â€” Ð²ÑÑ‘ ÑÐ²ÑÐ·Ð°Ð½Ð¾ Ð¿Ð¾ `trace_id`.

---

## ðŸ”¹ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð°Ð»ÐµÑ€Ñ‚Ð° Ð¸Ð· Grafana

```
- alert: HighErrorRate
  expr: rate(http_requests_total{status=~"5.."}[5m]) 
        / rate(http_requests_total[5m]) > 0.02
  for: 10m
  labels:
    severity: critical
  annotations:
    summary: "ÐžÑˆÐ¸Ð±ÐºÐ° API > 2%"
    runbook: "https://runbooks.tbank.local/payments/high-error-rate"

```

> Ð­Ñ‚Ð¾Ñ‚ Ð°Ð»ÐµÑ€Ñ‚ Ð´ÑƒÐ±Ð»Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð² Slack Ð¸Ð»Ð¸ Jira Ñ‡ÐµÑ€ÐµÐ· Alertmanager Ð¸ Grafana Alerting.

---

## ðŸ”¹ ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ñ‚Ð¸Ð¿Ð¾Ð²Ð¾Ð³Ð¾ Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´Ð°

Ð’ Grafana Ð´Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð´Ð»Ñ FastAPI-ÑÐµÑ€Ð²Ð¸ÑÐ° â€œpayments-apiâ€ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚:

1. **Latency (p95, p99)** â€” Ð¸Ð· Prometheus
    
2. **Error rate** â€” Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ 5xx
    
3. **Request rate (RPS)**
    
4. **Kafka consumer lag**
    
5. **RabbitMQ DLQ size**
    
6. **Postgres deadlocks / slow queries**
    
7. **CPU, memory, pod restarts**
    
8. **ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ / Ð·Ð°ÐºÐ°Ð·Ð¾Ð² / Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ (Ð±Ð¸Ð·Ð½ÐµÑ)**
    
9. **Annotation â€” Ð´ÐµÐ¿Ð»Ð¾Ð¹** (Ð¼ÐµÑ‚ÐºÐ° Ð½Ð° Ð³Ñ€Ð°Ñ„Ð¸ÐºÐµ Ð¿Ñ€Ð¸ Ð²Ñ‹ÐºÐ»Ð°Ð´ÐºÐµ Ð²ÐµÑ€ÑÐ¸Ð¸)
    

---

## ðŸ”¹ Ð¡Ð²ÑÐ·ÐºÐ° Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸

|Ð˜Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚|Ð Ð¾Ð»ÑŒ|Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Grafana|
|---|---|---|
|**Prometheus**|Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸|Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ datasource|
|**Loki**|Ð»Ð¾Ð³Ð¸|`trace_id` â†’ Ð»Ð¾Ð³Ð¸|
|**Tempo / Jaeger**|Ñ‚Ñ€ÐµÐ¹ÑÑ‹|`trace_id` â†’ trace view|
|**Alertmanager / PagerDuty**|ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ|Ð°Ð»ÐµÑ€Ñ‚Ñ‹ Ð¸Ð· Grafana|
|**PostgreSQL / ClickHouse**|Ð±Ð¸Ð·Ð½ÐµÑ-Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°|SQL-Ð¿Ð°Ð½ÐµÐ»Ð¸|

---

## ðŸ’¬ ÐšÐ°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ ÐºÑ€Ð°ÑÐ¸Ð²Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐ¸Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚

> Ð¢Ð¾ ÐµÑÑ‚ÑŒ Grafana â€” ÑÑ‚Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ð¾ â€œÐ³Ñ€Ð°Ñ„Ð¸ÐºÐ¸â€, Ð° **ÐµÐ´Ð¸Ð½Ð°Ñ Ñ‚Ð¾Ñ‡ÐºÐ° Ð½Ð°Ð±Ð»ÑŽÐ´Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸**:  
> Ñ‡ÐµÑ€ÐµÐ· Ð½ÐµÑ‘ Ñ Ð²Ð¸Ð¶Ñƒ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸, Ð»Ð¾Ð³Ð¸ Ð¸ Ñ‚Ñ€ÐµÐ¹ÑÑ‹ Ð»ÑŽÐ±Ð¾Ð³Ð¾ ÑÐµÑ€Ð²Ð¸ÑÐ°.
> 
> Ð’ Ð¢-Ð‘Ð°Ð½ÐºÐµ Ð¼Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÐµÑ‘ Ð´Ð»Ñ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° SLA, Ð±Ð¸Ð·Ð½ÐµÑ-Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¸ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð¹ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸ Ð¸Ð½Ñ†Ð¸Ð´ÐµÐ½Ñ‚Ð¾Ð² â€” Ð²ÑÑ‘ Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð¾, Ð±ÐµÐ· Ð·Ð°Ñ…Ð¾Ð´Ð° Ð² ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒ Ð¸Ð»Ð¸ kubectl.
> 