**Spatial-–∏–Ω–¥–µ–∫—Å—ã (–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã)** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç **–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –∏—Å–∫–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º**, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é, –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è–º —Ñ–∏–≥—É—Ä, –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∏ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏.

–û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è:

- –ø–æ–∏—Å–∫–∞ —Ç–æ—á–µ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
    
- –≥–µ–æ–ø–æ–∏—Å–∫–∞ –≤ —Ä–∞–¥–∏—É—Å–µ
    
- –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –ø–æ–ª–∏–≥–æ–Ω–æ–≤
    
- GIS-—Å–∏—Å—Ç–µ–º
    
- —Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–µ–æ–º–µ—Ç—Ä–∏–π –≤ PostGIS / MySQL / MongoDB
    

–û–±—ä—è—Å–Ω—è—é –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–º —è–∑—ã–∫–æ–º üëá

---

# üß© –ó–∞—á–µ–º –Ω—É–∂–Ω—ã spatial –∏–Ω–¥–µ–∫—Å—ã?

–û–±—ã—á–Ω—ã–π B-Tree –∏–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —Ç–∞–∫–æ–µ:

- –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ X/Y
    
- —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
    
- –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Ñ–∏–≥—É—Ä
    
- –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –¥–∏–∞–ø–∞–∑–æ–Ω
    

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞, –≥–¥–µ B-Tree –Ω–µ –ø–æ–º–æ–∂–µ—Ç:

`SELECT * FROM shops WHERE ST_DWithin(location, mypoint, 500);`

–≠—Ç–æ –ø–æ–∏—Å–∫ —Ç–æ—á–µ–∫ –≤ —Ä–∞–¥–∏—É—Å–µ 500 –º ‚Äî —Ç—É—Ç –Ω—É–∂–µ–Ω **–≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–π –∏–Ω–¥–µ–∫—Å**, –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π.

Spatial –∏–Ω–¥–µ–∫—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç —Ç–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ **–≤ —Ç—ã—Å—è—á–∏ —Ä–∞–∑**.

---

# üèó –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã spatial –∏–Ω–¥–µ–∫—Å–æ–≤

–ï—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä.

---

## ‚≠ê 1. **R-Tree** (—Å–∞–º—ã–π –ø–æ–ø—É–ª—è—Ä–Ω—ã–π)

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

- PostGIS (PostgreSQL)
    
- SQLite (Virtual R-Tree)
    
- MySQL (InnoDB + MBR)
    
- Oracle Spatial
    

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç R-Tree?

–ö–∞–∂–¥—ã–π –æ–±—ä–µ–∫—Ç (—Ç–æ—á–∫–∞, –ª–∏–Ω–∏—è, –ø–æ–ª–∏–≥–æ–Ω) –∏–º–µ–µ—Ç **–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—é—â–∏–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫** (MBR ‚Äî minimum bounding rectangle).

–¢–æ—á–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤ ¬´–±–æ–∫—Å—ã¬ª:

`+---------------------+ |  group 1 (rect)     | |   contains:         | |    (1,2), (1,3)     | +---------------------+  +---------------------+ |  group 2 (rect)     | |    (10,9), (9,8)    | +---------------------+`

–î–µ—Ä–µ–≤–æ —Ö—Ä–∞–Ω–∏—Ç **–∏–µ—Ä–∞—Ä—Ö–∏—é –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤**.

–ü–æ–∏—Å–∫:

1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è MBR
    
2. –°–ø—É—Å–∫–∞–µ–º—Å—è –≤ –Ω—É–∂–Ω—ã–µ –≤–µ—Ç–≤–∏
    
3. –û—Ç–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ, –∫—Ç–æ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è
    

–†–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ ‚ú®.

---

## ‚≠ê 2. **QuadTree**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

- –¥–≤–∏–∂–∫–∞—Ö –∏–≥—Ä
    
- GIS
    
- –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö NoSQL
    

–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 4 –∫–≤–∞–¥—Ä–∞–Ω—Ç–∞:

`+----+----+ | UL | UR | +----+----+ | LL | LR | +----+----+`

–ö–∞–∂–¥—ã–π –∫–≤–∞–¥—Ä–∞–Ω—Ç —Å–Ω–æ–≤–∞ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 4 ‚Äî —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.

–•–æ—Ä–æ—à–æ –¥–ª—è:

- —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫
    
- –±—ã—Å—Ç—Ä—ã—Ö —Ä–∞–¥–∏—É—Å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    

---

## ‚≠ê 3. **KD-Tree**

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤:

- –º–∞—à–∏–Ω–Ω–æ–º –æ–±—É—á–µ–Ω–∏–∏
    
- 2D/3D –ø–æ–∏—Å–∫–µ
    
- nearest-neighbor queries
    

–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–µ–ª–∏—Ç—Å—è –Ω–µ –∫–≤–∞–¥—Ä–∞–Ω—Ç–∞–º–∏, –∞ –ø–æ –æ—Å–∏ X –∏–ª–∏ Y.

–ü—Ä–∏–º–µ—Ä:  
–°–Ω–∞—á–∞–ª–∞ —Ä–∞–∑–¥–µ–ª—è–µ–º –ø–æ X, –ø–æ—Ç–æ–º –ø–æ Y, –ø–æ—Ç–æ–º —Å–Ω–æ–≤–∞ –ø–æ X...

---

## ‚≠ê 4. **GeoHash + B-Tree** (MySQL, MongoDB)

–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫—É (—Ö–µ—à), –Ω–∞–ø—Ä–∏–º–µ—Ä:

`dr5r k3n2 ...`

–ú–æ–∂–Ω–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—ã–º B-Tree.

–ò–¥–µ–∞–ª—å–Ω–æ –¥–ª—è:

- –ø—Ä–æ—Å—Ç–æ–≥–æ –≥–µ–æ–ø–æ–∏—Å–∫–∞
    
- –∫—Ä—É–≥–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ bounding boxes
    

---

# üåç –ö–∞–∫ spatial –∏–Ω–¥–µ–∫—Å—ã –ø–æ–º–æ–≥–∞—é—Ç –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

### ‚úî `ST_DWithin(point, center, radius)`

–ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ä–∞–¥–∏—É—Å–µ.

### ‚úî `ST_Intersects(geom1, geom2)`

–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –ø–æ–ª–∏–≥–æ–Ω–æ–≤.

### ‚úî `ST_Contains(a, b)`

–ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ –æ–±—ä–µ–∫—Ç –≤–Ω—É—Ç—Ä–∏ –¥—Ä—É–≥–æ–≥–æ.

### ‚úî `ST_Within(a, b)`

–¢–æ—á–∫–∞ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª–∏–≥–æ–Ω–∞.

### ‚úî `ST_MakeEnvelope(xmin, ymin, xmax, ymax)`

–ü–æ–∏—Å–∫ –ø–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫—É.

–ë–µ–∑ spatial-–∏–Ω–¥–µ–∫—Å–∞ —Ç–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–µ–ª–∞–ª–∏ –±—ã **full scan –ø–æ –≤—Å–µ–º –≥–µ–æ–º–µ—Ç—Ä–∏—è–º**, —á—Ç–æ –∫—Ä–∞–π–Ω–µ –º–µ–¥–ª–µ–Ω–Ω–æ.

---

# üî• –í —Ä–µ–∞–ª—å–Ω—ã—Ö –±–∞–∑–∞—Ö

## PostgreSQL + PostGIS

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **GiST –∏–Ω–¥–µ–∫—Å**, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è R-Tree.

–ü—Ä–∏–º–µ—Ä:

`CREATE INDEX idx_shops_loc ON shops USING gist (location);`

---

## MySQL

–î–ª—è –≥–µ–æ–º–µ—Ç—Ä–∏–∏:

- MBR (bounding rectangle)
    
- Spatial indexes (R-Tree in InnoDB)
    

---

## MongoDB

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç **2dsphere –∏–Ω–¥–µ–∫—Å** (–≥–µ–æ—Ö–µ—à + R-tree-like).

–ü—Ä–∏–º–µ—Ä:

`db.places.createIndex({ location: "2dsphere" });`

---

## SQLite

–ò–º–µ–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π R-Tree –º–æ–¥—É–ª—å.

---

# üßæ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ spatial –∏–Ω–¥–µ–∫—Å–æ–≤

‚úî –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É  
‚úî –∏–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –≥–µ–æ-–∑–∞–ø—Ä–æ—Å–æ–≤  
‚úî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å–ª–æ–∂–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã  
‚úî –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è –Ω–∞ –º–∏–ª–ª–∏–æ–Ω—ã —Ç–æ—á–µ–∫  
‚úî —Ä–∞–±–æ—Ç–∞—é—Ç —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏ –∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è–º–∏

---

# ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

‚ùå –¥–æ—Ä–æ–∂–µ –≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ (–≥–µ–æ–º–µ—Ç—Ä–∏—è —Å–ª–æ–∂–Ω–∞—è)  
‚ùå –∑–∞–Ω–∏–º–∞—é—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏, —á–µ–º –æ–±—ã—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã  
‚ùå –ø–ª–æ—Ö–æ –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è OLTP —Å —á–∞—Å—Ç—ã–º–∏ UPDATE  
‚ùå —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π

---

# üéØ –ò—Ç–æ–≥

**Spatial –∏–Ω–¥–µ–∫—Å ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º (—Ç–æ—á–∫–∏, –ø–æ–ª–∏–≥–æ–Ω—ã, –≥–µ–æ–≥—Ä–∞—Ñ–∏—è).**

–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ:

- **R-Tree** (PostGIS, MySQL)
    
- **GiST** (–æ–±—â–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è R-Tree –≤ PostgreSQL)
    
- **QuadTree**, **KD-Tree**
    
- **GeoHash + B-Tree**
    
- **2dsphere (MongoDB)**
    

–û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:

- –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å —Ç–æ—á–∫–∏ –≤ —Ä–∞–¥–∏—É—Å–µ
    
- —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—é —Ñ–∏–≥—É—Ä
    
- —É—Å–∫–æ—Ä—è—Ç—å GIS, –∫–∞—Ä—Ç—ã, –º–∞—Ä—à—Ä—É—Ç—ã, –≥–µ–æ-–ø–æ–∏—Å–∫

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:

**–ü—Ä–∏–º–µ—Ä**:

**–î–æ–ø. —Å—Å—ã–ª–∫–∏:** [[–ò–Ω–¥–µ–∫—Å—ã]]

**Tags**: #IT #Backend  #–ë–∞–∑–∞–î–∞–Ω–Ω—ã—Ö 