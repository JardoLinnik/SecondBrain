# –ß—Ç–æ —Ç–∞–∫–æ–µ 2PL (–¥–≤—É—Ö—Ñ–∞–∑–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)

**2PL = Two-Phase Locking = –¥–≤—É—Ö—Ñ–∞–∑–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** ‚Äî —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª, –∫–æ—Ç–æ—Ä—ã–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å **–∏–∑–æ–ª—è—Ü–∏—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (–æ–±—ã—á–Ω–æ —É—Ä–æ–≤–µ–Ω—å Serializable).

–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è –ø—Ä–æ—Å—Ç–∞:

> **–ö–∞–∂–¥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —Å–Ω–∞—á–∞–ª–∞ —Ç–æ–ª—å–∫–æ _–±–µ—Ä—ë—Ç_ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –∞ –ø–æ—Ç–æ–º —Ç–æ–ª—å–∫–æ _–æ—Ç–¥–∞—ë—Ç_ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏.  
> –ù–µ–ª—å–∑—è –±—Ä–∞—Ç—å –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –Ω–∞—á–∞–ª –∏—Ö –æ—Ç–¥–∞–≤–∞—Ç—å.**

–ò–º–µ–Ω–Ω–æ –ø–æ—ç—Ç–æ–º—É –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è **–¥–≤—É—Ö-—Ñ–∞–∑–Ω—ã–º**:

# –î–≤–µ —Ñ–∞–∑—ã 2PL

## üîπ 1. –§–∞–∑–∞ —Ä–æ—Å—Ç–∞ (growing phase)

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:

- –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (read locks, write locks)
    
- –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –Ω–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    
- –Ω–µ–ª—å–∑—è –æ—Ç–ø—É—Å–∫–∞—Ç—å
    

`LOCK ‚Üí LOCK ‚Üí LOCK ‚Üí ...`

## üîπ 2. –§–∞–∑–∞ —Å–∂–∞—Ç–∏—è (shrinking phase)

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:

- –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–ø—É—Å–∫–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    
- –ù–ï–õ–¨–ó–Ø –±—Ä–∞—Ç—å –Ω–æ–≤—ã–µ!
    

`UNLOCK ‚Üí UNLOCK ‚Üí UNLOCK ...`

–ü–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ —Ñ–∞–∑—É ¬´–æ—Ç–ø—É—Å–∫–∞–Ω–∏—è¬ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —É–∂–µ –Ω–µ –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ –Ω–æ–≤—É—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Å–µ–∫—Ü–∏—é.

---

# ‚≠ê –ó–∞—á–µ–º –Ω—É–∂–µ–Ω 2PL?

–ß—Ç–æ–±—ã **–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏**, —Ç–∞–∫–∏–µ –∫–∞–∫:

- dirty read
    
- non-repeatable read
    
- phantom read
    

2PL –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–∏–¥—è—Ç ¬´–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É¬ª.

2PL ‚Äî —ç—Ç–æ –æ–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ –¥–æ–±–∏—Ç—å—Å—è —É—Ä–æ–≤–Ω—è **Serializable**.

---

# ‚≠ê –ù–æ –≤–∞–∂–Ω–æ: 2PL –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å deadlock!

–ü–æ—á–µ–º—É?

–ü–æ—Ç–æ–º—É —á—Ç–æ:

- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ê –∂–¥—ë—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —É B
    
- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è B –∂–¥—ë—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —É A  
    ‚Üí –Ω–∏ –æ–¥–Ω–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
    

–ö–∞–∫ –≤ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–æ–º –ø—Ä–∏–º–µ—Ä–µ:

`T1: LOCK A T2: LOCK B T1: LOCK B  ‚Üê –∂–¥—ë—Ç T2: LOCK A  ‚Üê –∂–¥—ë—Ç`

Deadlock!

–ü–æ—ç—Ç–æ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–æ–±–∞–≤–ª—è—é—Ç:

- –¥–µ—Ç–µ–∫—Ç–æ—Ä—ã –¥–µ–¥–ª–æ–∫–æ–≤
    
- —Ç–∞–π–º–∞—É—Ç—ã
    

---

# ‚≠ê –ü—Ä–æ—Å—Ç–æ–π –ø—Ä–∏–º–µ—Ä 2PL

–î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Ö–æ—Ç—è—Ç –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ –¥–µ–Ω—å–≥–∏ –Ω–∞ —Å—á–µ—Ç–∞—Ö A –∏ B.

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T1:

`LOCK A LOCK B ... –æ–ø–µ—Ä–∞—Ü–∏–∏ ... UNLOCK B UNLOCK A`

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T2:

`LOCK B LOCK A`

–ï—Å–ª–∏ –æ–±–µ –±–µ—Ä—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –≤ –æ–¥–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ ‚Üí –≤—Å—ë –æ–∫.  
–ï—Å–ª–∏ –≤ —Ä–∞–∑–Ω–æ–º ‚Üí deadlock.

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**:

**–ü—Ä–∏–º–µ—Ä**:

**–î–æ–ø. —Å—Å—ã–ª–∫–∏:** [[–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏]]

**Tags**: #IT #Backend  #–ë–∞–∑–∞–î–∞–Ω–Ω—ã—Ö 